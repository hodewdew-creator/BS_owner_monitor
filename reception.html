<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BS 대기실 모니터 (리셉용)</title>
  <style>
    :root{
      --bg:#fafafa; --card:#ffffff; --border:#e5e7eb;
      --fg:#0f172a; --muted:#64748b;
      --brand:#2b5fa3; --brand-ink:#102339;
      --btn:#f1f5f9; --btn-ink:#111827; --btn-hover:#e2e8f0;
      --pill:#1f2937;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:1100px; margin:0 auto; padding:14px}
    .top{
      position:sticky; top:0; z-index:20; background:#fafafacc; backdrop-filter:blur(8px);
      display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 8px; border-bottom:1px solid var(--border);
    }
    .title{display:flex; align-items:center; gap:8px}
    .pill{
      background:#111827; color:#e5e7eb; border:1px solid #1f2937; padding:4px 10px; border-radius:999px; font-weight:800; font-size:13px;
    }
    .grid{
      display:grid; gap:14px; grid-template-columns: 1.3fr 1fr;
    }
    @media (max-width:980px){ .grid{grid-template-columns: 1fr;} }

    .panel{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px}
    .panel h3{margin:0 0 8px; font-size:16px}
    .toolbar{
      display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px;
    }
    .btn{
      background:var(--btn); color:var(--btn-ink); border:1px solid #cbd5e1;
      padding:8px 12px; border-radius:10px; font-weight:800; cursor:pointer;
    }
    .btn:hover{background:var(--btn-hover)}
    .btn.dark{background:#0f172a;color:#e5e7eb;border-color:#0b1220}

    .list{display:flex; flex-direction:column; gap:10px; max-height:70vh; overflow:auto}
    .line{
      display:grid; grid-template-columns: 1fr .8fr .9fr 1fr auto; gap:10px;
      align-items:center; padding:10px; border:1px solid var(--border); border-radius:12px;
    }
    .name{font-weight:900}
    .muted{color:var(--muted)}
    .sep{opacity:.5}
    .f12{font-size:12px}

    /* 입력창 그리드 */
    .inputs-wrap{
      display:grid; gap:10px;
      grid-template-columns: 1fr 1fr 1fr auto;
      align-items:center;
    }
    @media (max-width:900px){
      .inputs-wrap{ grid-template-columns: 1fr 1fr; }
    }

    /* input은 "자기 칼럼을 꽉 채우기"만! (고정폭은 그리드가 담당) */
    .inputs-wrap input{
      width:100%;
      min-width:0;
      padding:8px 10px;
      border:1px solid #cbd5e1;
      border-radius:10px;
      font-size:15px;
      background:#fff;
      box-sizing:border-box;
    }

    .err{
      display:none; position:fixed; inset:auto 12px 12px 12px; z-index:50;
      padding:10px 12px; border-radius:12px; background:#f87171; color:#111; font-weight:800; border:1px solid #7f1d1d;
    }
  </style>
</head>
<body>
  <div class="top">
    <div class="title">
      <span class="pill">BS 리셉션</span>
      <span class="muted f12">상태 지정 & 환자 관리</span>
    </div>
    <div class="right muted f12">내부 전용</div>
  </div>

  <div class="wrap">
    <div id="err" class="err"></div>

    <div class="grid">
      <!-- 왼쪽: 상태 변경 -->
      <div class="panel">
        <h3>상태 설정</h3>

        <div class="toolbar" id="row1"></div>
        <div class="toolbar" id="row2"></div>
        <div class="toolbar" id="row3"></div>

        <div class="inputs-wrap" style="margin-top:12px">
          <input id="patientName" placeholder="환자명"/>
          <input id="guardianName" placeholder="보호자명"/>
          <input id="memo" placeholder="메모 (선택)"/>
          <button id="addBtn" class="btn">추가</button>
        </div>
      </div>

      <!-- 오른쪽: 목록 -->
      <div class="panel">
        <h3>환자 목록</h3>
        <div id="list" class="list"></div>
      </div>
    </div>
  </div>

  <script type="module">
    const errBox=document.getElementById('err');
    const showErr=(msg)=>{ errBox.textContent=msg; errBox.style.display='block'; }
    const hideErr=()=>{ errBox.style.display='none'; }

    let auth, provider, db;
    let selectedId=null;

    const patientName=document.getElementById('patientName');
    const guardianName=document.getElementById('guardianName');
    const memoInput=document.getElementById('memo');
    const addBtn=document.getElementById('addBtn');

    const elList=document.getElementById('list');

    try{
      const { initializeApp }=await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js");
      const { getAuth, GoogleAuthProvider, signInWithPopup }=await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js");
      const { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc }=await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js");

      const app = initializeApp({
        apiKey: "AIzaSyDUMMYxxxx",
        authDomain: "bs-owner-monitor.firebaseapp.com",
        projectId: "bs-owner-monitor",
      });
      auth=getAuth(app); provider=new GoogleAuthProvider(); db=getFirestore(app);
      await signInWithPopup(auth, provider);

      // 추가
      addBtn.onclick=async()=>{
        const pn=(patientName.value||"").trim();
        const gn=(guardianName.value||"").trim();
        if(!pn || !gn){ showErr("환자명/보호자명을 입력

